<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href='{{ url_for('static', filename='style.css')}}' />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" type="text/css" href="//use.fontawesome.com/releases/v5.7.2/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>All Users</title>
</head>
<body bgcolor="#f3f3f3">
    <div class="user-list">
        <form action="{{ url_for('all_users') }}" method="post">
            <div class="mainTableHeader">
                <div class="leftControls">
                    <a href="{{ url_for('dashboard') }}">
                        <button type="button" class="goBack">
                            <span><i class="ph-bold ph-arrow-left"></i></span>
                        </button>
                    </a>
                    <h1>All Users</h1>
                </div>
                <div class="operatingTools">
                    <div class="searchContainer">
                        <input type="text" id="searchInput" name="search_query" placeholder="Search...">
                        <button type="submit"><i class="ph-bold ph-magnifying-glass"></i></button>
                    </div>
                    {{ form.hidden_tag() }}
                    <button type="submit" class="deleteUser" name="delete_selected">
                        <span><i class="ph-bold ph-trash"></i></span> Delete User
                    </button>
                    <a href="{{ url_for('register') }}">
                        <button type="button" class="createUser">
                            <span><i class="ph-bold ph-plus-circle"></i> Create</span>
                        </button>
                    </a>
                </div>
            </div>
            <div class="outerContainer">
                <div class="table-container">
                    <table>
                        <thead class="tableHeadRow"> 
                            <tr>
                                <th><input type="checkbox" class="checkbox" id="masterCheckbox" onclick="toggleCheckboxes(this)"></th> <!-- Add an empty header for checkboxes -->
                                <th style="text-align: center;">#</th>
                                <!-- <th>ID</th> -->
                                <th>Username</th>
                                <th>Email</th>
                                <th>Name</th>
                                <th>Telephone No</th>
                                <th>Level</th>
                            </tr>
                        </thead> 
                        <!-- {% set row_number = 1 %} -->
                        <tbody>
                            {% for user in users %}
                            <tr style="cursor: pointer;" onclick="if(event.target.tagName !== 'INPUT') window.location='{{ url_for('get_user_by_username', username=user.username) }}';"> 
                                <td style="border-radius: 10px;">
                                    <input type="checkbox" class="checkbox" name="user_checkbox" value="{{ user.id }}" {% if user.id == current_user.id %} disabled {% endif %}>
                                </td>
                                <td style="text-align: center;">{{ loop.index }}</td>  <!-- Display the row number -->
                                <!-- <td>{{ user.id }}</td> -->
                                <td>{{ user.username }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.name }}</td>
                                <td>{{ user.telephoneNo }}</td>
                                <td style="border-radius: 10px;">{{ user.level }}</td>
                            </tr>
                            <!-- {% set row_number = row_number + 1 %} -->
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </form>
    </div>
    <div class="contactMe" id="contactMe">
        <div class="innerContainer">
            <p style="padding-right: 20px;">Designed & developed By Amiru Weerathunga</p>
            <div class="contactInfo">
                <span>0768452122</span>
                <div class="socialLinks">
                    <a href="https://www.linkedin.com/in/amiru-weerathunga-499878280/" target="_blank"><i class="fa-brands fa-linkedin" style="color: #0077b5;"></i> <span class="linkText">LinkedIn</span></a>
                    <a href="https://www.youtube.com/@Amiru_Weerathunga/featured" target="_blank"><i class="fa-brands fa-youtube" style="color: #CD201F;"></i> <span class="linkText">YouTube</span></a>
                    <a href="https://github.com/Amiru2007" target="_blank"><i class="fa-brands fa-github" style="color: #000000;"></i> <span class="linkText">GitHub</span></a>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('form').addEventListener('submit', function(event) {
                event.preventDefault();

                const formData = new FormData(this);

                // Log the user_checkbox values for debugging
                console.log(formData.getAll('user_checkbox'));

                fetch(this.action, {
                    method: this.method,
                    body: formData,
                })
                .then(response => response.text())
                .then(html => {
                    document.querySelector('.user-list').innerHTML = html;
                });
            });

            // Other code remains the same...
        });


        function toggleCheckboxes(masterCheckbox) {
            const checkboxes = document.querySelectorAll('tbody input[name="user_checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = masterCheckbox.checked;
            });
        }

        // function isAdminRow(checkbox) {
        //     const row = checkbox.closest('tr');
        //     const levelCell = row.querySelector('td:last-child');
        //     return levelCell && levelCell.textContent.trim().toLowerCase() === 'admin';
        // }

        // function setCheckboxName(checkbox) {
        //     const row = checkbox.closest('tr');
        //     const levelCell = row.querySelector('td:last-child');
            
        //     if (levelCell && levelCell.textContent.trim().toLowerCase() === 'admin') {
        //         checkbox.setAttribute('name', 'AdminCheckbox');
        //     } else {
        //         checkbox.setAttribute('name', 'user_checkbox');
        //     }
        // }
        if (window.location.href.includes('reload')) {
            window.location.reload();
        }
    </script>    
</body>
</html>
