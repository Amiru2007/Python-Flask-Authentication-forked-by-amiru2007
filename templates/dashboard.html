<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href='{{ url_for('static', filename='style.css')}}' />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Dashboard</title>
</head>

<body class="dashboard">
    <div class="header-logo">
        <img class="logo-image" src="{{ url_for('static', filename='logo.jpg') }}" alt="Dayartne Holdings Logo">
    </div>
    <div class="toolsAndPreview">
        <div class="tools">
            <div class="grid-container">
                <!-- New Visitor -->
                {% if current_user.level in ['Admin', 'Approver', 'Requester'] %}
                    <div class="grid-item">
                        <span><i class="ph ph-plus-circle"></i></span>
                        <h3>New Visitor</h3>
                        <a href="{{ url_for('new_visitor') }}"><button type="button">Create</button></a>
                    </div>
                {% endif %}

                <!-- Arrive Visitor -->
                {% if current_user.level == 'Gate' %}
                    <div class="grid-item">
                        <span><i class="ph ph-arrow-circle-right"></i></span>
                        <h3>Arrive Visitor</h3>
                        <button type="button" id="showApprovedList" onclick="openShowApprovedList()"><i class="ph ph-arrow-right"></i></button>
                    </div>
                {% endif %}

                <!-- Depart Visitor -->
                {% if current_user.level == 'Gate' %}
                    <div class="grid-item">
                        <span><i class="ph ph-check-circle"></i></span>
                        <h3>Depart Visitor</h3>
                        <button type="button" id="showArrivedList" onclick="openArrivedList()"><i class="ph ph-arrow-right"></i></button>
                    </div>
                {% endif %}
                
                <!-- Approve Visitor -->
                {% if current_user.level == 'Admin' or current_user.level == 'Approver' %}
                    <div class="grid-item">
                        <span><i class="ph ph-paper-plane-tilt"></i></span>
                        <h3>Approve Visitor</h3>
                        <button type="button" id="showToApproveList" onclick="openToApproveList()"><i class="ph ph-arrow-right"></i></button>
                    </div>
                {% endif %}

                {% if current_user.level == 'Admin' %}
                    <div class="grid-item">
                        <span><i class="ph ph-password"></i></span>
                        <h3>Change Password</h3>
                        <a href="{{ url_for('change_password') }}"><button type="button">Change</button></a>
                    </div>
                {% endif %}

                <!-- Delete User -->
                {% if current_user.level == 'Admin' %}
                    <div class="grid-item">
                        <span><i class="ph ph-user"></i></i></span>
                        <h3>User Management</h3>
                        <a href="{{ url_for('all_users') }}"><button type="button">Manage</button></a>
                    </div>
                {% endif %}

                <!-- Reports -->
                {% if current_user.level == 'Admin' %}
                    <div class="grid-item">
                        <span><i class="ph ph-scroll"></i></span>
                        <h3>Reports</h3>
                        <button type="button" id="showReportButtons" onclick="openReports()"><i class="ph ph-arrow-right"></i></button>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="overlay" id="pendingApprovaloverlay" onclick="closeShowApprovedList()"></div>
        <div class="popup" id="pendingApproval">
            <div class="popupHeader">
                <h3>Approved Visitor List</h3>
                <button onclick="closeShowApprovedList()"><i class="ph ph-x"></i></button>
            </div>
            <ul class="toApprove">
                {% for visitor in approved_visitor_numbers %}
                    <li>
                        <form method="post" action="{{ url_for('arrive_visitor') }}">
                            <input type="hidden" name="visitor_no" value="{{ visitor }}">
                            <button type="submit">{{ visitor }}</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="overlay" id="ApprovedVisitorsoverlay" onclick="closeToApproveList()"></div>
        <div class="popup" id="ApprovedVisitors">
            <div class="popupHeader">
                <h3>Pending Approval Visitor List</h3>
                <button onclick="closeToApproveList()"><i class="ph ph-x"></i></button>
            </div>
            <ul class="toApprove">
                {% for visitor in pending_visitor_numbers %}
                    <li>
                        <form method="post" action="{{ url_for('get_visitor') }}">
                            <input type="hidden" name="visitor_no" value="{{ visitor }}">
                            <button type="submit">{{ visitor }}</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="overlay" id="arrivedOverlay" onclick="closeArrivedList()"></div>
        <div class="popup" id="arrivedVisitors">
            <div class="popupHeader">
                <h3>Arrived Visitor List</h3>
                <button onclick="closeArrivedList()"><i class="ph ph-x"></i></button>
            </div>
            <ul class="toApprove">
                {% for visitor in arrived_visitor_numbers %}
                    <li>
                        <form method="post" action="{{ url_for('depart_visitor') }}">
                            <input type="hidden" name="visitor_no" value="{{ visitor }}">
                            <button type="submit">{{ visitor }}</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="overlay" id="reportOverlay" onclick="closeReports()"></div>
        <div class="popup" id="reportButtons">
            <div class="popupHeader" style="position: relative; width: 100%;">
                <h3>Export Reports</h3>
                <button onclick="closeReports()"><i class="ph ph-x"></i></button>
            </div>
            <div class="reportButtonsContainer">
                <form action="/export_excel_user" method="POST" class="excelExportBtns">
                    <span><i class="ph ph-user-list"></i></span>
                    <h5>User Report</h5>
                    <button type="submit">Export</button>
                </form>
                <div class="excelExportBtns" onclick="openVisitorReport()">
                    <span><i class="ph ph-user-square"></i></span>
                    <h5>Visitor Reports</h5>
                    <button type="button">Create</button>
                </div>
            </div>
        </div>
        <div class="overlay" id="visitorReportOverlay" onclick="closeVisitorReport()"></div>
        <div class="popup" id="visitorReportButtons">
            <div class="popupHeader" style="position: relative; width: 100%;">
                <h3>Set Duration</h3>
                <button onclick="closeVisitorReport()"><i class="ph ph-x"></i></button>
            </div>
            <form action="/export_excel_visitor" method="POST" class="excelExportVisitorBtns">
                <div class="startDate excelTimeDuration">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" name="startDate">
                </div>
                <div class="endDate excelTimeDuration">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" name="endDate">
                </div>
                <input type="submit" class="exportVisitorExcel" id="exportVisitorExcel" value="Export">
            </form>
        </div>
    </div>
    <div class="dashboard-footer">
        <a href="{{url_for('logout')}}"><button type="button">logout</button></a>
    </div>
    <div class="contactMe" id="contactMe">
        <div class="innerContainer">
            <p style="padding-right: 20px;">Designed & developed By Amiru Weerathunga</p>
            <div class="contactInfo">
                <span>0768452122</span>
                <div class="socialLinks">
                    <a href="https://www.linkedin.com/in/amiru-weerathunga-499878280/" target="_blank"><i class="fa-brands fa-linkedin"></i> <span class="linkText">LinkedIn</span></a>
                    <a href="https://www.youtube.com/@Amiru_Weerathunga/featured" target="_blank"><i class="fa-brands fa-youtube"></i> <span class="linkText">YouTube</span></a>
                    <a href="https://github.com/Amiru2007" target="_blank"><i class="fa-brands fa-github"></i> <span class="linkText">GitHub</span></a>
                </div>
            </div>
        </div>
    </div>
    <script>
        function openShowApprovedList() {
            document.getElementById('pendingApprovaloverlay').classList.add('visible');
            document.getElementById('pendingApproval').classList.add('visible');
            document.getElementById('contactMe').classList.add('hide');
        }

        function closeShowApprovedList() {
            document.getElementById('pendingApprovaloverlay').classList.remove('visible');
            document.getElementById('pendingApproval').classList.remove('visible');
            document.getElementById('contactMe').classList.remove('hide');
        }

        function openToApproveList() {
            document.getElementById('ApprovedVisitorsoverlay').classList.add('visible');
            document.getElementById('ApprovedVisitors').classList.add('visible');
            document.getElementById('contactMe').classList.add('hide');
        }

        function closeToApproveList() {
            document.getElementById('ApprovedVisitorsoverlay').classList.remove('visible');
            document.getElementById('ApprovedVisitors').classList.remove('visible');
            document.getElementById('contactMe').classList.remove('hide');
        }

        function openArrivedList() {
            document.getElementById('arrivedOverlay').classList.add('visible');
            document.getElementById('arrivedVisitors').classList.add('visible');
            document.getElementById('contactMe').classList.add('hide');
        }

        function closeArrivedList() {
            document.getElementById('arrivedOverlay').classList.remove('visible');
            document.getElementById('arrivedVisitors').classList.remove('visible');
            document.getElementById('contactMe').classList.remove('hide');
        }

        function openReports() {
            document.getElementById('reportOverlay').classList.add('visible');
            document.getElementById('reportButtons').classList.add('visible');
            document.getElementById('contactMe').classList.add('hide');
        }

        function closeReports() {
            document.getElementById('reportOverlay').classList.remove('visible');
            document.getElementById('reportButtons').classList.remove('visible');
            document.getElementById('contactMe').classList.remove('hide');
        }

        function openVisitorReport() {
            document.getElementById('reportOverlay').classList.remove('visible');
            document.getElementById('reportButtons').classList.remove('visible');
            document.getElementById('visitorReportOverlay').classList.add('visible');
            document.getElementById('visitorReportButtons').classList.add('visible');
            document.getElementById('contactMe').classList.add('hide');
        }

        function closeVisitorReport() {
            document.getElementById('visitorReportOverlay').classList.remove('visible');
            document.getElementById('visitorReportButtons').classList.remove('visible');
            document.getElementById('contactMe').classList.remove('hide');
        }
    </script>    
</body>
</html>